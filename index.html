<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sasnaka Sansada | AI Support</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@400;600&family=Noto+Sans+Tamil:wght@400;600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
    :root {
        --primary: #3b82f6;       
        --primary-dark: #2563eb; 
        --accent: #06b6d4;        
        --gradient: linear-gradient(135deg, #3b82f6, #06b6d4);
        --glass-bg: rgba(255, 255, 255, 0.92);
        --glass-border: rgba(255, 255, 255, 0.6);
        --shadow-lg: 0 20px 50px rgba(37, 99, 235, 0.25);
    }

    body {
        font-family: 'Outfit', 'Noto Sans Sinhala', 'Noto Sans Tamil', sans-serif;
        background: #f0f4f8; 
        margin: 0;
        height: 100vh;
        /* Cool Grid Background */
        background-image: 
            linear-gradient(rgba(59, 130, 246, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(59, 130, 246, 0.05) 1px, transparent 1px);
        background-size: 30px 30px;
    }

    /* Floating Button */
    .chat-toggle-btn {
        position: fixed; bottom: 30px; right: 30px;
        width: 65px; height: 65px;
        background: var(--gradient);
        border-radius: 50%; color: white; border: none; cursor: pointer;
        box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4); z-index: 1000;
        display: flex; align-items: center; justify-content: center; font-size: 26px;
        transition: all 0.4s; animation: pulse-blue 2s infinite;
    }
    @keyframes pulse-blue { 
        0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); } 
        70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); } 
        100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } 
    }
    .chat-toggle-btn:hover { transform: scale(1.1); }
    .chat-toggle-btn.open { transform: rotate(180deg); background: #334155; }

    /* Chat Window */
    .chat-widget {
        position: fixed; bottom: 110px; right: 30px;
        width: 380px; height: 600px;
        background: var(--glass-bg); backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border); border-radius: 24px;
        box-shadow: var(--shadow-lg);
        display: flex; flex-direction: column; overflow: hidden; z-index: 999;
        opacity: 0; transform: scale(0) translate(50px, 100px); pointer-events: none;
        transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
    }
    /* Mobile Responsive */
    @media (max-width: 480px) {
        .chat-widget { width: 90%; right: 5%; bottom: 100px; height: 70vh; }
    }
    .chat-widget.active { opacity: 1; transform: scale(1) translate(0, 0); pointer-events: all; }

    /* Header */
    .header {
        background: var(--gradient); padding: 15px 20px;
        display: flex; align-items: center; justify-content: space-between; color: white;
    }
    .header-text h2 { margin: 0; font-size: 18px; font-weight: 600; }
    .header-text p { margin: 2px 0 0 0; font-size: 12px; opacity: 0.9; }

    .header-actions { display: flex; gap: 8px; align-items: center; }
    
    .lang-select {
        background: rgba(255,255,255,0.2); color: white;
        border: 1px solid rgba(255,255,255,0.3); border-radius: 8px;
        padding: 5px 8px; font-size: 12px; font-weight: 600; cursor: pointer; outline: none;
    }
    .lang-select option { background: #334155; color: white; }

    .action-btn {
        background: rgba(255,255,255,0.2); border: none; color: white;
        width: 32px; height: 32px; border-radius: 10px; cursor: pointer; transition: 0.2s;
    }
    .action-btn:hover { background: white; color: var(--primary); }

    /* Chat Area */
    #chat-history {
        flex: 1; padding: 20px; overflow-y: auto;
        display: flex; flex-direction: column; gap: 16px; scroll-behavior: smooth;
    }
    #chat-history::-webkit-scrollbar { width: 6px; }
    #chat-history::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

    .message { max-width: 80%; padding: 14px 18px; border-radius: 18px; font-size: 14px; line-height: 1.5; animation: slideUp 0.3s ease forwards; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .bot-message { background: white; color: #1e293b; border-bottom-left-radius: 4px; border: 1px solid #e2e8f0; }
    .bot-message a { color: var(--primary); font-weight: 600; text-decoration: none; }
    .bot-message a:hover { text-decoration: underline; }
    .user-message { background: var(--gradient); color: white; border-bottom-right-radius: 4px; margin-left: auto; }

    /* Suggestions */
    .suggestions { display: flex; gap: 8px; padding: 10px 15px; border-top: 1px solid #e2e8f0; overflow-x: auto; white-space: nowrap; }
    .suggestions::-webkit-scrollbar { height: 4px; }
    .suggestions::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    
    .chip {
        background: white; border: 1px solid #e2e8f0; padding: 6px 12px; border-radius: 20px;
        font-size: 12px; color: #64748b; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 5px;
    }
    .chip:hover { background: var(--primary); color: white; border-color: var(--primary); transform: translateY(-2px); }

    /* Input */
    .input-area { padding: 15px; background: white; display: flex; gap: 10px; align-items: center; border-top: 1px solid #f1f5f9; }
    input {
        flex: 1; padding: 12px 16px; border-radius: 25px; border: 2px solid #e2e8f0;
        outline: none; font-family: inherit; font-size: 14px; transition: all 0.3s; background: #f8fafc;
    }
    input:focus { border-color: var(--primary); background: white; }
    #send-btn {
        background: var(--gradient); color: white; border: none; width: 45px; height: 45px; border-radius: 50%;
        cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.2s;
    }
    #send-btn:hover { transform: scale(1.1); }

    .typing { margin-left: 20px; margin-bottom: 10px; display: none; background: white; padding: 8px 12px; border-radius: 12px; width: fit-content; border: 1px solid #e2e8f0; }
    .dot { display: inline-block; width: 6px; height: 6px; background: #94a3b8; border-radius: 50%; animation: wave 1.3s linear infinite; }
    .dot:nth-child(2) { animation-delay: -1.1s; } .dot:nth-child(3) { animation-delay: -0.9s; }
    @keyframes wave { 0%, 60%, 100% { transform: initial; } 30% { transform: translateY(-5px); } }

    /* Donation Modal */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);
        z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px);
    }
    .modal-content {
        width: 90%; max-width: 500px; height: 80%; background: white; border-radius: 20px; overflow: hidden; display: flex; flex-direction: column; animation: popIn 0.3s ease;
    }
    @keyframes popIn { from{transform:scale(0.8); opacity:0;} to{transform:scale(1); opacity:1;} }
    .modal-header { padding: 15px; background: var(--primary); color: white; display: flex; justify-content: space-between; align-items: center; font-weight: 600; }
    .close-modal { background: none; border: none; color: white; font-size: 20px; cursor: pointer; }

</style>
</head>
<body>

    <!-- Website Placeholder -->
    <div style="height: 100vh; display: flex; align-items: center; justify-content: center; color: #64748b; flex-direction: column; text-align: center;">
        <h1 style="font-size: 3rem; color: #1e293b; margin-bottom: 10px;">Sasnaka Sansada</h1>
        <p>Empowering Future Generations.</p>
        <p style="margin-top: 50px; color: #3b82f6;">(Click the blue button bottom-right!)</p>
    </div>

    <!-- Toggle Button -->
    <button class="chat-toggle-btn" id="toggle-btn" onclick="toggleChat()">
        <i class="fa-solid fa-comment-dots"></i>
    </button>

    <!-- Chat Widget -->
    <div class="chat-widget" id="chat-widget">
        <div class="header">
            <div class="header-text">
                <h2>Sasnaka AI</h2>
                <p>Online Support</p>
            </div>
            <div class="header-actions">
                <select id="lang-select" class="lang-select" onchange="changeLanguage()">
                    <option value="en">EN</option>
                    <option value="si">SI</option>
                    <option value="ta">TA</option>
                </select>
                <button class="action-btn" onclick="window.open('https://wa.me/94724401111', '_blank')" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></button>
                <button class="action-btn" onclick="toggleChat()"><i class="fa-solid fa-chevron-down"></i></button>
            </div>
        </div>

        <div id="chat-history"></div>
        
        <div class="typing" id="typing-indicator">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>

        <div class="suggestions" id="suggestions-area"></div>

        <div class="input-area">
            <input id="user-input" type="text" placeholder="Ask a question..." />
            <button id="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- Donation Modal -->
    <div class="modal-overlay" id="donation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="donate-title">Make a Donation</span>
                <button class="close-modal" onclick="closeDonationModal()">&times;</button>
            </div>
            <!-- PASTE YOUR GOOGLE FORM LINK HERE BELOW -->
            <iframe 
                src="https://docs.google.com/forms/d/e/1FAIpQLSfD-EfM7C53Qq3L8z6k0k_v0/viewform?embedded=true" 
                width="100%" height="100%" frameborder="0" marginheight="0" marginwidth="0">
                Loading‚Ä¶
            </iframe>
        </div>
    </div>

<script>
// ==========================================
// 1. CONFIGURATION (PASTE API KEY HERE)
// ==========================================
const API_KEY = "AIzaSyCjioyG9XymsjBqFqGjfMBgfJ5AU-oyF7g"; 
// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

// Knowledge Base (Moved from Server to Client)
const BASE_KNOWLEDGE = `
You are the official AI Assistant for "Sasnaka Sansada", a non-profit in Sri Lanka.
Your persona: Mentor, Encouraging, Knowledgeable, and Kind.

--- KEY INFO ---
1. **Name:** Sasnaka Sansada.
2. **Hotline:** 072 440 1111.
3. **WhatsApp:** [Click to Chat](https://wa.me/94724401111).
4. **Mission:** Empowering youth via seminars (O/L, A/L) and scholarships.

--- RULES ---
- If asked for "Contact", give 0724401111 and the WhatsApp link.
- If asked a Subject Question (Math/Science), answer it as a tutor.
- If asked about Donation, say "Click the Donate button".
`;

// --- UI ELEMENTS ---
const widget = document.getElementById('chat-widget');
const toggleBtn = document.getElementById('toggle-btn');
const chatHistory = document.getElementById('chat-history');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');
const typingInd = document.getElementById('typing-indicator');
const donationModal = document.getElementById('donation-modal');
const langSelect = document.getElementById('lang-select');
const suggestionsArea = document.getElementById('suggestions-area');

let isOpen = false;
let currentLang = 'en';

// --- TRANSLATIONS ---
const translations = {
    en: {
        welcome: "Ayubowan! Welcome to Sasnaka Sansada. üíô<br>How can I help you today?",
        placeholder: "Ask a question...",
        donateTitle: "Make a Donation",
        chips: [
            { text: "Who are we?", icon: "fa-circle-question", action: "text" },
            { text: "Contact Us", icon: "fa-phone", action: "text" },
            { text: "Scholarships", icon: "fa-graduation-cap", action: "text" },
            { text: "Donate", icon: "fa-heart", action: "modal", style: "color:var(--primary); border-color:var(--primary);" }
        ]
    },
    si: {
        welcome: "‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä! ‡∑É‡∑É‡∑ä‡∂±‡∂ö ‡∑É‡∂Ç‡∑É‡∂Ø‡∂∫‡∂ß ‡∑É‡∑è‡∂Ø‡∂ª‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∂±‡∑í‡∂∏‡∑î. üíô<br>‡∂î‡∂∂‡∂ß ‡∂ö‡∑ô‡∑É‡∑ö‡∂Ø ‡∂ã‡∂Ø‡∑Ä‡∑ä ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö‡∑ä‡∂ö‡∑ö?",
        placeholder: "‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫‡∂ö‡∑ä ‡∂Ö‡∑É‡∂±‡∑ä‡∂±...",
        donateTitle: "‡∂Ü‡∂∞‡∑è‡∂ª ‡∂Ω‡∂∂‡∑è‡∂Ø‡∑ì‡∂∏",
        chips: [
            { text: "‡∂Ö‡∂¥‡∑í ‡∂ö‡∑Ä‡∑î‡∂Ø?", icon: "fa-circle-question", action: "text" },
            { text: "‡∂Ö‡∂¥ ‡∂Ö‡∂∏‡∂≠‡∂±‡∑ä‡∂±", icon: "fa-phone", action: "text" },
            { text: "‡∑Å‡∑í‡∑Ç‡∑ä‚Äç‡∂∫‡∂≠‡∑ä‡∑Ä", icon: "fa-graduation-cap", action: "text" },
            { text: "‡∂Ü‡∂∞‡∑è‡∂ª", icon: "fa-heart", action: "modal", style: "color:var(--primary); border-color:var(--primary);" }
        ]
    },
    ta: {
        welcome: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æö‡Ææ‡Æ∏‡Øç‡Æ©‡Æï ‡Æö‡Æ©‡Øç‡Æö‡Æ§‡Ææ‡Æµ‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç. üíô<br>‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æµ‡Øç‡Æµ‡Ææ‡Æ±‡ØÅ ‡Æâ‡Æ§‡Æµ ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç?",
        placeholder: "‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç...",
        donateTitle: "‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà",
        chips: [
            { text: "‡Æ®‡Ææ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆØ‡Ææ‡Æ∞‡Øç?", icon: "fa-circle-question", action: "text" },
            { text: "‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡ØÅ", icon: "fa-phone", action: "text" },
            { text: "‡Æï‡Æ≤‡Øç‡Æµ‡Æø ‡Æâ‡Æ§‡Æµ‡Æø", icon: "fa-graduation-cap", action: "text" },
            { text: "‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà", icon: "fa-heart", action: "modal", style: "color:var(--primary); border-color:var(--primary);" }
        ]
    }
};

// --- RENDER UI ---
function renderUI(lang) {
    const t = translations[lang];
    userInput.placeholder = t.placeholder;
    document.getElementById('donate-title').textContent = t.donateTitle;
    chatHistory.innerHTML = ''; 
    appendMessage(t.welcome, false);
    suggestionsArea.innerHTML = '';
    t.chips.forEach(chip => {
        const div = document.createElement('div');
        div.className = 'chip';
        div.innerHTML = `<i class="fa-solid ${chip.icon}"></i> ${chip.text}`;
        if(chip.style) div.style.cssText = chip.style;
        div.onclick = () => {
            if(chip.action === 'modal') openDonationModal();
            else { userInput.value = chip.text; sendMessage(); }
        };
        suggestionsArea.appendChild(div);
    });
}

function changeLanguage() {
    currentLang = langSelect.value;
    renderUI(currentLang);
}

// --- LOGIC ---
function toggleChat() {
    isOpen = !isOpen;
    if (isOpen) {
        widget.classList.add('active');
        toggleBtn.classList.add('open');
        toggleBtn.innerHTML = '<i class="fa-solid fa-xmark"></i>';
        setTimeout(() => userInput.focus(), 300);
    } else {
        widget.classList.remove('active');
        toggleBtn.classList.remove('open');
        toggleBtn.innerHTML = '<i class="fa-solid fa-comment-dots"></i>';
    }
}

function appendMessage(text, isUser) {
    const div = document.createElement('div');
    div.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
    if (isUser) div.innerText = text;
    else div.innerHTML = marked.parse(text);
    chatHistory.appendChild(div);
    chatHistory.scrollTop = chatHistory.scrollHeight;
}

// --- DIRECT API CALL (No Server) ---
async function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;

    appendMessage(text, true);
    userInput.value = '';
    typingInd.style.display = 'block';
    chatHistory.scrollTop = chatHistory.scrollHeight;

    // Construct Language Instruction
    let langInstruction = "";
    if (currentLang === 'si') langInstruction = "Reply in SINHALA only.";
    else if (currentLang === 'ta') langInstruction = "Reply in TAMIL only.";
    else langInstruction = "Reply in ENGLISH.";

    const fullPrompt = `${BASE_KNOWLEDGE}\n\n${langInstruction}`;

    try {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                systemInstruction: { parts: [{ text: fullPrompt }] },
                contents: [{ parts: [{ text: text }] }]
            })
        });

        const data = await response.json();
        typingInd.style.display = 'none';

        if (data.candidates) {
            appendMessage(data.candidates[0].content.parts[0].text, false);
        } else {
            console.error("API Error:", data);
            appendMessage("API Error. Check console.", false);
        }
    } catch (err) {
        typingInd.style.display = 'none';
        appendMessage("Network error. Please check your connection.", false);
        console.error(err);
    }
}

function openDonationModal() { donationModal.style.display = 'flex'; }
function closeDonationModal() { donationModal.style.display = 'none'; }
donationModal.addEventListener('click', (e) => { if(e.target === donationModal) closeDonationModal(); });

sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMessage(); });

// Init
renderUI('en');
</script>
</body>
</html>
