<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GeoVision LK | Dashboard Support</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@400;600&family=Noto+Sans+Tamil:wght@400;600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
    :root {
        --primary: #0f172a;        /* Dark Navy for Data/Corporate feel */
        --primary-dark: #020617; 
        --accent: #3b82f6;        /* Bright Blue for Tech feel */
        --gradient: linear-gradient(135deg, #0f172a, #3b82f6);
        --glass-bg: rgba(255, 255, 255, 0.95);
        --glass-border: rgba(255, 255, 255, 0.6);
        --shadow-lg: 0 20px 50px rgba(15, 23, 42, 0.25);
    }

    body {
        font-family: 'Outfit', 'Noto Sans Sinhala', 'Noto Sans Tamil', sans-serif;
        background: #f8fafc; 
        margin: 0;
        height: 100vh;
        /* Tech Grid Background */
        background-image: 
            linear-gradient(rgba(15, 23, 42, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(15, 23, 42, 0.05) 1px, transparent 1px);
        background-size: 40px 40px;
    }

    /* Floating Button */
    .chat-toggle-btn {
        position: fixed; bottom: 30px; right: 30px;
        width: 65px; height: 65px;
        background: var(--gradient);
        border-radius: 50%; color: white; border: none; cursor: pointer;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.4); z-index: 1000;
        display: flex; align-items: center; justify-content: center; font-size: 26px;
        transition: all 0.4s; animation: pulse-blue 2s infinite;
    }
    @keyframes pulse-blue { 
        0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); } 
        70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); } 
        100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } 
    }
    .chat-toggle-btn:hover { transform: scale(1.1); }
    .chat-toggle-btn.open { transform: rotate(180deg); background: #334155; }

    /* Chat Window */
    .chat-widget {
        position: fixed; bottom: 110px; right: 30px;
        width: 380px; height: 600px;
        background: var(--glass-bg); backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border); border-radius: 24px;
        box-shadow: var(--shadow-lg);
        display: flex; flex-direction: column; overflow: hidden; z-index: 999;
        opacity: 0; transform: scale(0) translate(50px, 100px); pointer-events: none;
        transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
    }
    /* Mobile Responsive */
    @media (max-width: 480px) {
        .chat-widget { width: 90%; right: 5%; bottom: 100px; height: 70vh; }
    }
    .chat-widget.active { opacity: 1; transform: scale(1) translate(0, 0); pointer-events: all; }

    /* Header */
    .header {
        background: var(--gradient); padding: 15px 20px;
        display: flex; align-items: center; justify-content: space-between; color: white;
    }
    .header-text h2 { margin: 0; font-size: 18px; font-weight: 600; }
    .header-text p { margin: 2px 0 0 0; font-size: 12px; opacity: 0.9; }

    .header-actions { display: flex; gap: 8px; align-items: center; }
    
    .lang-select {
        background: rgba(255,255,255,0.2); color: white;
        border: 1px solid rgba(255,255,255,0.3); border-radius: 8px;
        padding: 5px 8px; font-size: 12px; font-weight: 600; cursor: pointer; outline: none;
    }
    .lang-select option { background: #334155; color: white; }

    .action-btn {
        background: rgba(255,255,255,0.2); border: none; color: white;
        width: 32px; height: 32px; border-radius: 10px; cursor: pointer; transition: 0.2s;
    }
    .action-btn:hover { background: white; color: var(--primary); }

    /* Chat Area */
    #chat-history {
        flex: 1; padding: 20px; overflow-y: auto;
        display: flex; flex-direction: column; gap: 16px; scroll-behavior: smooth;
    }
    #chat-history::-webkit-scrollbar { width: 6px; }
    #chat-history::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

    .message { max-width: 80%; padding: 14px 18px; border-radius: 18px; font-size: 14px; line-height: 1.5; animation: slideUp 0.3s ease forwards; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .bot-message { background: white; color: #1e293b; border-bottom-left-radius: 4px; border: 1px solid #e2e8f0; }
    .bot-message a { color: var(--accent); font-weight: 600; text-decoration: none; }
    .bot-message a:hover { text-decoration: underline; }
    .bot-message strong { color: var(--primary); }
    .user-message { background: var(--gradient); color: white; border-bottom-right-radius: 4px; margin-left: auto; }

    /* Suggestions */
    .suggestions { display: flex; gap: 8px; padding: 10px 15px; border-top: 1px solid #e2e8f0; overflow-x: auto; white-space: nowrap; }
    .suggestions::-webkit-scrollbar { height: 4px; }
    .suggestions::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    
    .chip {
        background: white; border: 1px solid #e2e8f0; padding: 6px 12px; border-radius: 20px;
        font-size: 12px; color: #64748b; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 5px;
    }
    .chip:hover { background: var(--accent); color: white; border-color: var(--accent); transform: translateY(-2px); }

    /* Input */
    .input-area { padding: 15px; background: white; display: flex; gap: 10px; align-items: center; border-top: 1px solid #f1f5f9; }
    input {
        flex: 1; padding: 12px 16px; border-radius: 25px; border: 2px solid #e2e8f0;
        outline: none; font-family: inherit; font-size: 14px; transition: all 0.3s; background: #f8fafc;
    }
    input:focus { border-color: var(--accent); background: white; }
    #send-btn {
        background: var(--gradient); color: white; border: none; width: 45px; height: 45px; border-radius: 50%;
        cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.2s;
    }
    #send-btn:hover { transform: scale(1.1); }

    .typing { margin-left: 20px; margin-bottom: 10px; display: none; background: white; padding: 8px 12px; border-radius: 12px; width: fit-content; border: 1px solid #e2e8f0; }
    .dot { display: inline-block; width: 6px; height: 6px; background: #94a3b8; border-radius: 50%; animation: wave 1.3s linear infinite; }
    .dot:nth-child(2) { animation-delay: -1.1s; } .dot:nth-child(3) { animation-delay: -0.9s; }
    @keyframes wave { 0%, 60%, 100% { transform: initial; } 30% { transform: translateY(-5px); } }

</style>
</head>
<body>

    <!-- Website Placeholder -->
    <div style="height: 100vh; display: flex; align-items: center; justify-content: center; color: #64748b; flex-direction: column; text-align: center;">
        <h1 style="font-size: 3rem; color: #0f172a; margin-bottom: 10px;">GeoVision LK</h1>
        <p style="font-size: 1.2rem;">Interactive 3D Data Visualization Dashboard</p>
        <p style="margin-top: 50px; color: #3b82f6;">(Click the blue button bottom-right!)</p>
    </div>

    <!-- Toggle Button -->
    <button class="chat-toggle-btn" id="toggle-btn" onclick="toggleChat()">
        <i class="fa-solid fa-comment-dots"></i>
    </button>

    <!-- Chat Widget -->
    <div class="chat-widget" id="chat-widget">
        <div class="header">
            <div class="header-text">
                <h2>GeoVision Support</h2>
                <p>Dashboard Assistant</p>
            </div>
            <div class="header-actions">
                <select id="lang-select" class="lang-select" onchange="changeLanguage()">
                    <option value="en">EN</option>
                    <option value="si">SI</option>
                    <option value="ta">TA</option>
                </select>
                <button class="action-btn" onclick="toggleChat()"><i class="fa-solid fa-chevron-down"></i></button>
            </div>
        </div>

        <div id="chat-history"></div>
        
        <div class="typing" id="typing-indicator">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>

        <div class="suggestions" id="suggestions-area"></div>

        <div class="input-area">
            <input id="user-input" type="text" placeholder="Ask about the dashboard..." />
            <button id="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

<script>
// ==========================================
// 1. CONFIGURATION
// ==========================================
// IMPORTANT: Keep the key as requested.
const API_KEY = "AIzaSyAYL2HePusRySc2lZRFhnHIAEJHF1yfLGo"; 
// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

// Knowledge Base based on "GeoVision-LK-Dashboard-Interactive-3D-Data-Visualization.pdf"
const BASE_KNOWLEDGE = `
You are the AI Support Assistant for "GeoVision LK", a project developing an Interactive 3D Field Reporting Dashboard.
Your persona: Professional, Tech-savvy, and Helpful.

--- PROJECT OVERVIEW ---
The GeoVision LK Dashboard is a web-based tool designed to transform static field reports (spreadsheets) into a dynamic, interactive 3D map.
Target Audience: Program managers, operational teams, and non-technical stakeholders.
Goal: To act as a "visual operations control room" for instant insights.

--- KEY FEATURES ---
1. **Interactive 3D Map:** Users can see operations geographically. Hover/click regions for details.
2. **Unified Interface:** All KPIs (Key Performance Indicators) and summaries in one view.
3. **District Detail Cards:** Pop-ups with charts, contact info, and PDF/photo attachments for specific districts.
4. **Switchable Views:** Toggle between "This Week" vs "Cumulative" data, or filter by program type.
5. **Simple Data Input:** Supports manual forms and Excel/CSV imports.

--- BENEFITS ---
- **Faster Decisions:** Identify hotspots and gaps instantly without reading spreadsheets.
- **Clear Storytelling:** Visual data helps communicate impact to donors/partners.
- **Simplified Reporting:** Reduces time spent creating manual quarterly reports.

--- TIMELINE (11 Weeks) ---
- **Weeks 1-2:** Planning & Design (Mockups, Requirements).
- **Weeks 3-5:** Core Development (Main map interface).
- **Weeks 6-7:** Feature Expansion (Detail panels, charts).
- **Week 8:** Data Integration (Import tools).
- **Weeks 9-10:** Testing & Optimization (Mobile responsiveness).
- **Week 11:** Deployment & Handover.

--- RISKS & MITIGATION ---
1. **Inconsistent Data:** Mitigated by validation checks and cleaning tools.
2. **Slow Map Loading:** Mitigated by using optimized 3D models and 2D fallbacks.
3. **Low Adoption:** Mitigated by mandatory training and simple 1-page guides.

--- CONTACT ---
For admin access or technical support, please contact the Project Owner or the System Administrator.
`;

// --- UI ELEMENTS ---
const widget = document.getElementById('chat-widget');
const toggleBtn = document.getElementById('toggle-btn');
const chatHistory = document.getElementById('chat-history');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');
const typingInd = document.getElementById('typing-indicator');
const langSelect = document.getElementById('lang-select');
const suggestionsArea = document.getElementById('suggestions-area');

let isOpen = false;
let currentLang = 'en';

// --- TRANSLATIONS ---
const translations = {
    en: {
        welcome: "Hello! I am the GeoVision Assistant. üåç<br>Ask me about the new 3D Dashboard features, timeline, or benefits.",
        placeholder: "Ask about the dashboard...",
        chips: [
            { text: "Main Features", icon: "fa-list-check" },
            { text: "Project Timeline", icon: "fa-calendar" },
            { text: "Why use this?", icon: "fa-lightbulb" },
            { text: "Potential Risks", icon: "fa-triangle-exclamation" }
        ]
    },
    si: {
        welcome: "‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä! GeoVision ‡∑É‡∑Ñ‡∑è‡∂∫‡∂ö ‡∑Ä‡∑ô‡∂≠ ‡∑É‡∑è‡∂Ø‡∂ª‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∂±‡∑í‡∂∏‡∑î. üåç<br>‡∂±‡∑Ä 3D Dashboard ‡∑Ñ‡∑í ‡∑Ä‡∑í‡∑Å‡∑ö‡∑Ç‡∑è‡∂Ç‡∂ú ‡∑Ñ‡∑ù ‡∂ö‡∑è‡∂Ω‡∂ª‡∑è‡∂∏‡∑î‡∑Ä ‡∂ú‡∑ê‡∂± ‡∑Ä‡∑í‡∂∏‡∑É‡∂±‡∑ä‡∂±.",
        placeholder: "‡∂©‡∑ë‡∑Ç‡∑ä‡∂∂‡∑ù‡∂©‡∑ä ‡∂ë‡∂ö ‡∂ú‡∑ê‡∂± ‡∂Ö‡∑É‡∂±‡∑ä‡∂±...",
        chips: [
            { text: "‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∂Ö‡∂Ç‡∂ú", icon: "fa-list-check" },
            { text: "‡∂ö‡∑è‡∂Ω‡∂ª‡∑è‡∂∏‡∑î‡∑Ä", icon: "fa-calendar" },
            { text: "‡∑Ä‡∑è‡∑É‡∑í ‡∂∏‡∑ú‡∂±‡∑Ä‡∑è‡∂Ø?", icon: "fa-lightbulb" },
            { text: "‡∂Ö‡∑Ä‡∂Ø‡∑è‡∂±‡∂∏‡∑ä", icon: "fa-triangle-exclamation" }
        ]
    },
    ta: {
        welcome: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! GeoVision ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç. üåç<br>‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ 3D Dashboard ‡ÆÖ‡ÆÆ‡Øç‡Æö‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Æ±‡Øç‡Æ±‡Æø ‡Æï‡Øá‡Æü‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
        placeholder: "‡Æü‡Ææ‡Æ∑‡Øç‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡ØÅ ‡Æ™‡Æ±‡Øç‡Æ±‡Æø ‡Æï‡Øá‡Æü‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç...",
        chips: [
            { text: "‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ ‡ÆÖ‡ÆÆ‡Øç‡Æö‡Æô‡Øç‡Æï‡Æ≥‡Øç", icon: "fa-list-check" },
            { text: "‡Æï‡Ææ‡Æ≤‡Æï‡Øç‡Æï‡ØÜ‡Æü‡ØÅ", icon: "fa-calendar" },
            { text: "‡Æ™‡ÆØ‡Æ©‡Øç‡Æï‡Æ≥‡Øç", icon: "fa-lightbulb" },
            { text: "‡Æá‡Æü‡Æ∞‡Øç‡Æï‡Æ≥‡Øç", icon: "fa-triangle-exclamation" }
        ]
    }
};

// --- RENDER UI ---
function renderUI(lang) {
    const t = translations[lang];
    userInput.placeholder = t.placeholder;
    chatHistory.innerHTML = ''; 
    appendMessage(t.welcome, false);
    suggestionsArea.innerHTML = '';
    t.chips.forEach(chip => {
        const div = document.createElement('div');
        div.className = 'chip';
        div.innerHTML = `<i class="fa-solid ${chip.icon}"></i> ${chip.text}`;
        div.onclick = () => {
            userInput.value = chip.text; 
            sendMessage(); 
        };
        suggestionsArea.appendChild(div);
    });
}

function changeLanguage() {
    currentLang = langSelect.value;
    renderUI(currentLang);
}

// --- LOGIC ---
function toggleChat() {
    isOpen = !isOpen;
    if (isOpen) {
        widget.classList.add('active');
        toggleBtn.classList.add('open');
        toggleBtn.innerHTML = '<i class="fa-solid fa-xmark"></i>';
        setTimeout(() => userInput.focus(), 300);
    } else {
        widget.classList.remove('active');
        toggleBtn.classList.remove('open');
        toggleBtn.innerHTML = '<i class="fa-solid fa-comment-dots"></i>';
    }
}

function appendMessage(text, isUser) {
    const div = document.createElement('div');
    div.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
    if (isUser) div.innerText = text;
    else div.innerHTML = marked.parse(text);
    chatHistory.appendChild(div);
    chatHistory.scrollTop = chatHistory.scrollHeight;
}

// --- DIRECT API CALL ---
async function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;

    appendMessage(text, true);
    userInput.value = '';
    typingInd.style.display = 'block';
    chatHistory.scrollTop = chatHistory.scrollHeight;

    // Construct Language Instruction
    let langInstruction = "";
    if (currentLang === 'si') langInstruction = "Reply in SINHALA only.";
    else if (currentLang === 'ta') langInstruction = "Reply in TAMIL only.";
    else langInstruction = "Reply in ENGLISH.";

    const fullPrompt = `${BASE_KNOWLEDGE}\n\n${langInstruction}`;

    try {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                systemInstruction: { parts: [{ text: fullPrompt }] },
                contents: [{ parts: [{ text: text }] }]
            })
        });

        const data = await response.json();
        typingInd.style.display = 'none';

        if (data.candidates) {
            appendMessage(data.candidates[0].content.parts[0].text, false);
        } else {
            console.error("API Error:", data);
            const msg = data.error?.message || "Error connecting to AI.";
            appendMessage("API Error: " + msg, false);
        }
    } catch (err) {
        typingInd.style.display = 'none';
        appendMessage("Network error. Please check your connection.", false);
        console.error(err);
    }
}

sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMessage(); });

// Init
renderUI('en');
</script>
</body>
</html>
